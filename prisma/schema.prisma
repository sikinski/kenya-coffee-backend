generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int         @id @default(autoincrement())
  name        String      @default("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
  username    String      @unique
  password    String
  role        String // "admin" –∏–ª–∏ "user"
  createdAt   DateTime    @default(now())
  daily_tasks DailyTask[] // <-- –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
  notes       Note[] // üëà –¥–æ–±–∞–≤–∏–ª–∏ —Å–≤—è–∑—å —Å –∑–∞–º–µ—Ç–∫–∞–º–∏
}

model Task {
  id         Int         @id @default(autoincrement())
  text       String // —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏
  order      Int         @default(0) // –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  priority   String      @default("normal") // "low", "normal", "high"
  active     Boolean     @default(true) // –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∑–∞–¥–∞—á–∞ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö)
  createdAt  DateTime    @default(now())
  dailyTasks DailyTask[] // —Å–≤—è–∑—å —Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
}

model DailyTask {
  id     Int      @id @default(autoincrement())
  date   DateTime @db.Date // –¥–∞—Ç–∞ –∑–∞–¥–∞—á–∏ (—Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞, –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏)
  done   Boolean  @default(false)
  userId Int?
  user   User?    @relation(fields: [userId], references: [id])
  taskId Int
  task   Task     @relation(fields: [taskId], references: [id])

  @@unique([taskId, date]) // –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –¥–µ–Ω—å
  @@index([date]) // –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –¥–∞—Ç–µ
}

model Note {
  id         Int        @id @default(autoincrement())
  text       String
  author_id  Int
  author     User       @relation(fields: [author_id], references: [id])
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
  topicId    Int? // —Å–≤—è–∑—å —Å —Ç–µ–º–æ–π
  topic      NoteTopic? @relation(fields: [topicId], references: [id])
}

model NoteTopic {
  id         Int      @id @default(autoincrement())
  name       String // –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
  color      String // —Ü–≤–µ—Ç (hex, rgb –∏–ª–∏ tailwind-class ‚Äî —Ä–µ—à–∏–º —Å–∞–º–∏)
  notes      Note[]
  created_at DateTime @default(now())
}

model Receipt {
  id                 String   @id
  cashier_name       String
  discount           String?
  type               Int?
  customerInfo       Json?
  positions          Json?
  amount             Decimal
  calculationAddress String
  processedAt        String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model NativeReceipt {
  id             String   @id @default(cuid())
  aqsiId         String?  @unique
  raw            Json
  processedAt    DateTime @db.Timestamp(6)
  processedAtRaw String?
  createdAt      DateTime @default(now())
}

model StatsCache {
  id            String   @id @default(cuid())
  period        String // 'day', 'week', 'month', 'quarter', –∏–ª–∏ 'custom'
  from          DateTime
  to            DateTime
  revenue       Float // üí∞ –æ–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
  avgCheck      Float // üìà —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫
  receiptsCount Int // üßæ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤
  dayRevenue    Float // ‚òÄÔ∏è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –¥–µ–Ω—å
  createdAt     DateTime @default(now())
  devices       String?
}

// revenue,        // üí∞ –æ–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
//         avgCheck,       // üìà —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫
//         receiptsCount,  // üßæ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤
//         dayRevenue      // ‚òÄÔ∏è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –¥–µ–Ω—å
