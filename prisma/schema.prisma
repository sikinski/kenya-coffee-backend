generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int         @id @default(autoincrement())
  name        String      @default("–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
  username    String      @unique
  password    String
  role        String // "admin" –∏–ª–∏ "user"
  createdAt   DateTime    @default(now())
  daily_tasks DailyTask[] // <-- –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
  notes       Note[] // üëà –¥–æ–±–∞–≤–∏–ª–∏ —Å–≤—è–∑—å —Å –∑–∞–º–µ—Ç–∫–∞–º–∏
}

model Task {
  id         Int         @id @default(autoincrement())
  text       String // —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏
  order      Int         @default(0) // –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  priority   String      @default("normal") // "low", "normal", "high"
  active     Boolean     @default(true) // –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –∑–∞–¥–∞—á–∞ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö)
  createdAt  DateTime    @default(now())
  dailyTasks DailyTask[] // —Å–≤—è–∑—å —Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏
}

model DailyTask {
  id     Int      @id @default(autoincrement())
  date   DateTime @db.Date // –¥–∞—Ç–∞ –∑–∞–¥–∞—á–∏ (—Ç–æ–ª—å–∫–æ –¥–∞—Ç–∞, –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏)
  done   Boolean  @default(false)
  userId Int?
  user   User?    @relation(fields: [userId], references: [id])
  taskId Int
  task   Task     @relation(fields: [taskId], references: [id])

  @@unique([taskId, date]) // –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –¥–µ–Ω—å
  @@index([date]) // –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ –¥–∞—Ç–µ
}

model Note {
  id         Int        @id @default(autoincrement())
  text       String
  author_id  Int
  author     User       @relation(fields: [author_id], references: [id])
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
  topicId    Int? // —Å–≤—è–∑—å —Å —Ç–µ–º–æ–π
  topic      NoteTopic? @relation(fields: [topicId], references: [id])
}

model NoteTopic {
  id         Int      @id @default(autoincrement())
  name       String // –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–º—ã
  color      String // —Ü–≤–µ—Ç (hex, rgb –∏–ª–∏ tailwind-class ‚Äî —Ä–µ—à–∏–º —Å–∞–º–∏)
  notes      Note[]
  created_at DateTime @default(now())
}

model Receipt {
  id                 String   @id
  cashier_name       String
  discount           String?
  type               Int?
  customerInfo       Json?
  positions          Json?
  amount             Decimal
  calculationAddress String
  processedAt        String
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model NativeReceipt {
  id             String   @id @default(cuid())
  aqsiId         String?  @unique
  raw            Json
  processedAt    DateTime @db.Timestamp(6)
  processedAtRaw String?
  createdAt      DateTime @default(now())
}

model StatsCache {
  id            String   @id @default(cuid())
  period        String // 'day', 'week', 'month', 'quarter', –∏–ª–∏ 'custom'
  from          DateTime
  to            DateTime
  revenue       Float // üí∞ –æ–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
  avgCheck      Float // üìà —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫
  receiptsCount Int // üßæ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤
  dayRevenue    Float // ‚òÄÔ∏è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –¥–µ–Ω—å
  createdAt     DateTime @default(now())
  devices       String?
}

// ========== –ú–ï–ù–Æ ==========
model MenuItemType {
  id          Int        @id @default(autoincrement())
  name        String     @unique // "–∫–æ—Ñ–µ", "—á–∞–π", "–¥—Ä—É–≥–æ–π –Ω–∞–ø–∏—Ç–æ–∫", "—Å–∏—Ä–æ–ø", "–≤—ã–ø–µ—á–∫–∞", "—à–æ–∫–æ–ª–∞–¥"
  description String? // –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∏–ø–∞
  icon        String? // –∏–∫–æ–Ω–∫–∞ —Ç–∏–ø–∞ (base64 data URI, –Ω–∞–ø—Ä–∏–º–µ—Ä data:image/svg+xml;base64,...)
  order       Int        @default(0) // –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  items       MenuItem[]
}

model MenuTag {
  id        Int        @id @default(autoincrement())
  name      String     @unique // "–∫—Ä–µ–ø–∫–æ–µ", "—Å–ª–∞–¥–∫–æ–µ", "–¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤", "–Ω–æ–≤–∏–Ω–∫–∞", "—Å–µ–∑–æ–Ω–Ω–æ–µ", "—Ö–∏—Ç"
  color     String? // —Ü–≤–µ—Ç —Ç–µ–≥–∞ (hex –∑–Ω–∞—á–µ–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä #FF0000)
  icon      String? // –∏–∫–æ–Ω–∫–∞ —Ç–µ–≥–∞ (base64 data URI SVG, –Ω–∞–ø—Ä–∏–º–µ—Ä data:image/svg+xml;base64,...)
  category  String? // –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–µ–≥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  items     MenuItem[]
}

model MenuItem {
  id             Int            @id @default(autoincrement())
  name           String // –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
  description    String? // –æ–ø–∏—Å–∞–Ω–∏–µ
  price          Json // —Ü–µ–Ω–∞: –æ–±—ä–µ–∫—Ç { from: number | null, to: number | null }
  discountPrice  Decimal? // —Ü–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π
  imageOriginal  String? // –ø—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
  imageThumbnail String? // –ø—É—Ç—å –∫ —Å–∂–∞—Ç–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
  quantity       Int? // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–µ—Å–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ)
  volume         String[] // –æ–±—ä–µ–º –∏–ª–∏ –≤–µ—Å - –º–∞—Å—Å–∏–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ["250 –º–ª", "350 –º–ª"])
  rating         Float          @default(0) // —Å—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥ (0-5)
  ratingCount    Int            @default(0) // –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫
  active         Boolean        @default(true) // –∞–∫—Ç–∏–≤–Ω–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è
  order          Int            @default(0) // –ø–æ—Ä—è–¥–æ–∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  types          MenuItemType[] // —Å–≤—è–∑—å many-to-many —Å —Ç–∏–ø–∞–º–∏
  tags           MenuTag[] // —Å–≤—è–∑—å many-to-many —Å —Ç–µ–≥–∞–º–∏
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  @@index([active])
  @@index([order])
}

model Menu {
  id        Int      @id @default(autoincrement())
  updatedAt DateTime @default(now()) @updatedAt // –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–µ–Ω—é

  // –•—Ä–∞–Ω–∏–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –∑–∞–ø–∏—Å—å –º–µ–Ω—é (—Å–∏–Ω–≥–ª—Ç–æ–Ω)
  // –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ - —ç—Ç–æ MenuItem —Å active=true
}

// revenue,        // üí∞ –æ–±—â–∞—è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –ø–µ—Ä–∏–æ–¥
//         avgCheck,       // üìà —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫
//         receiptsCount,  // üßæ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤
//         dayRevenue      // ‚òÄÔ∏è –≤—ã—Ä—É—á–∫–∞ –∑–∞ –¥–µ–Ω—å
